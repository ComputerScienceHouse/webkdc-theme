# Makefile for WebAuth utilities

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
top_builddir	= @top_builddir@
VPATH		= @srcdir@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
datarootdir     = @datarootdir@
libdir		= @libdir@
mandir		= @mandir@
D		= $(DESTDIR)

man1dir		= $(mandir)/man1

VERSION		= @PACKAGE_VERSION@

CC		= @CC@
INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
LIBTOOL		= $(top_builddir)/libtool
RANLIB		= @RANLIB@

CFLAGS		= @CFLAGS@

CPPFLAGS	= -I$(top_builddir) -I$(top_srcdir)/src/libwebauth \
		  @CPPFLAGS@

LDFLAGS		= -L$(top_builddir)/src/libwebauth
LDLIBS		= -lwebauth @DEPEND_LIBS@ @LIBS@

PROGS		= wa_keyring
MAN		= wa_keyring.1

all: $(PROGS)

install: $(PROGS) $(srcdir)/wa_keyring.1
	$(INSTALL) -d $D$(bindir) $D$(man1dir)
	$(LIBTOOL) --mode=install $(INSTALL) wa_keyring $D$(bindir)/wa_keyring
	$(INSTALL_DATA) $(srcdir)/wa_keyring.1 $D$(man1dir)/wa_keyring.1

.c.o:
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

wa_keyring: wa_keyring.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ wa_keyring.o $(LDLIBS)

$(srcdir)/wa_keyring.1: wa_keyring.pod
	pod2man --release='$(VERSION)' --section=1 --center='User Programs' \
	    wa_keyring.pod > $@

clean:
	rm -rf $(PROGS) *.o .libs *~ core \#*

maintclean:
	rm -f wa_keyring.1

depend:
	$(top_srcdir)/tools/makedepend '$(CPPFLAGS)' *.c

# DO NOT DELETE THIS LINE -- make depend depends on it.
wa_keyring.o: wa_keyring.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h
