# Makefile for libwebauth
# $Id$

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
top_builddir	= @top_builddir@
VPATH		= @srcdir@

prefix          = @prefix@
exec_prefix     = @exec_prefix@
libdir		= @libdir@
D		= $(DESTDIR)

CC		= @CC@
INSTALL		= @INSTALL@
LIBTOOL		= $(top_builddir)libtool
RANLIB		= @RANLIB@

CFLAGS		= @CFLAGS@
CPPFLAGS	= -I. -I$(srcdir) -I$(top_builddir) @CPPFLAGS@ \
		  @CRYPTO_CPPFLAGS@ @KRB5_CPPFLAGS@
LDFLAGS		= @LDFLAGS@
LDLIBS		= @CRYPTO_LIBS@ @KRB5_LIBS@ @LIBS@

LIBNAME		= libwebauth

OBJS		= attrs.o base64.o key.o krb5.o misc.o random.o token.o
LOBJS		= $(OBJS:.o=.lo)

.SUFFIXES: .lo

all: $(LIBNAME).la

install: $(LIBNAME).la
	$(INSTALL) -d $D$(libdir)
	$(LIBTOOL) --mode=install \
	    $(INSTALL) $(LIBNAME).la $D$(libdir)/$(LIBNAME).la

.c.lo:
	$(LIBTOOL) --mode=compile $(CC) $(CPPFLAGS) $(CFLAGS) -c $<

$(LIBNAME).la: $(LOBJS)
	$(LIBTOOL) --mode=link $(CC) -o $@ $(LOBJS) $(LDFLAGS) $(LDLIBS) \
	    -rpath $(libdir) -version-info 2:0:1

clean:
	rm -rf *.o $(LIBNAME).la *.lo .libs *~ core \#*

depend:
	$(top_srcdir)/tools/makedepend '$(CPPFLAGS)' *.c

# DO NOT DELETE THIS LINE -- make depend depends on it.
attrs.o: attrs.c webauthp.h $(top_builddir)/config.h webauth.h
base64.o: base64.c webauthp.h $(top_builddir)/config.h webauth.h
key.o: key.c webauthp.h $(top_builddir)/config.h webauth.h
krb5.o: krb5.c webauthp.h $(top_builddir)/config.h webauth.h
misc.o: misc.c webauthp.h $(top_builddir)/config.h webauth.h
random.o: random.c webauthp.h $(top_builddir)/config.h webauth.h
token.o: token.c webauthp.h $(top_builddir)/config.h webauth.h
