# Makefile for the Webauth test suite
# $Id$

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
VPATH		= @srcdir@

APACHE_ROOT	= @APACHE_ROOT@

CC		= @CC@
CFLAGS		= @CFLAGS@
CPPFLAGS	= @CPPFLAGS@
LDFLAGS		= @LDFLAGS@

@SET_MAKE@

SUBDIRS = libwebauth

.PHONY: all check clean depend install

all check: runtests
	@for subdir in $(SUBDIRS); do \
	    echo "making $@ in $$subdir"; \
	    ( cd $$subdir && $(MAKE) $@ ) || exit 1; \
	done
	./runtests TESTS

clean:
	rm -f runtests webauth_keyring*
	@for subdir in $(SUBDIRS); do \
	    echo "making $@ in $$subdir"; \
	    ( cd $$subdir && $(MAKE) $@ ) || exit 1; \
	done

depend:
	@for subdir in $(SUBDIRS); do \
	    echo "making $@ in $$subdir"; \
	    ( cd $$subdir && $(MAKE) $@ ) || exit 1; \
	done

install:
	cp mod_webauth/conf/tests.conf $(APACHE_ROOT)/conf/webauth-tests.conf
	cp -r mod_webauth/htdocs/tests $(APACHE_ROOT)/htdocs/
	@echo 'WebAuth tests have been installed in $(APACHE_ROOT)'
	@echo 'Read $(APACHE_ROOT)/conf/webauth-tests.conf for more'
	@echo 'information on how to configure the test suite.'

runtests: runtests.o
	$(CC) $(LDFLAGS) -o $@ runtests.o
