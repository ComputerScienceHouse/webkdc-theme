# Makefile for the Webauth test suite
# $Id$

srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
top_builddir	= @top_builddir@
VPATH		= @srcdir@

CC		= @CC@
INSTALL		= @INSTALL@
LIBTOOL		= $(top_builddir)/libtool
RANLIB		= @RANLIB@

CFLAGS		= @CFLAGS@

CPPFLAGS	= -I$(top_builddir) -I$(top_srcdir)/src/libwebauth \
		  @CPPFLAGS@

LDFLAGS		= -L$(top_builddir)/src/libwebauth
LDLIBS		= -lwebauth @DEPEND_LIBS@ @LIBS@

TESTS		= attrs_test base64_test hex_test key_test krb5_test \
		  krb5_tgt_test token_test random_test

all: $(TESTS)

.c.o:
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

attrs_test: attrs_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ attrs_test.o $(LDLIBS)

base64_test: base64_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ base64_test.o $(LDLIBS)

hex_test: hex_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ hex_test.o $(LDLIBS)

key_test: key_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ key_test.o $(LDLIBS)

krb5_test: krb5_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ krb5_test.o $(LDLIBS)

krb5_tgt_test: krb5_tgt_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ krb5_tgt_test.o $(LDLIBS)

token_test: token_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ token_test.o $(LDLIBS)

random_test: random_test.o
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ random_test.o $(LDLIBS)

clean:
	rm -rf $(TESTS) *.o .libs *~ core \#* webauth_keyring*

depend:
	$(top_srcdir)/tools/makedepend '$(CPPFLAGS)' *.c

# DO NOT DELETE THIS LINE -- make depend depends on it.
attrs_test.o: attrs_test.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h \
  webauthtest.h
base64_test.o: base64_test.c $(top_builddir)/config.h \
  $(top_builddir)/src/libwebauth/webauth.h webauthtest.h
hex_test.o: hex_test.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h \
  webauthtest.h
key_test.o: key_test.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h \
  webauthtest.h
krb5_test.o: krb5_test.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h \
  webauthtest.h
krb5_tgt_test.o: krb5_tgt_test.c $(top_builddir)/config.h \
  $(top_builddir)/src/libwebauth/webauth.h webauthtest.h
random_test.o: random_test.c $(top_builddir)/config.h \
  $(top_builddir)/src/libwebauth/webauth.h webauthtest.h
token_test.o: token_test.c $(top_builddir)/config.h $(top_builddir)/src/libwebauth/webauth.h \
  webauthtest.h
