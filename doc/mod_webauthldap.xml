<?xml version="1.0"?>
<!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
<modulesynopsis>

<name>mod_webauthldap</name>
<description>LDAP Authorization and attribute lookup for WebAuth V3</description>
<status>Contributed</status>
<sourcefile>mod_webauthldap.c</sourcefile>
<identifier>webauthldap_module</identifier>

<summary>
<p>This module provides authorization based on configurable LDAP priviledge
 groups. It also allows retrieving adhoc LDAP attributes and places them in 
 environment variables. The module was designed for use with an LDAP server 
 that supports LDAP version 3 and allows binds authenticated using SASL 
 GSSAPI Kerberos V</p>

<p>For other Webauth documentation see the
<a href="http://webauthv3.stanford.edu/">WebAuthV3 documentation</a>.</p>
</summary>

<section><title>Using WebAuthLdap Authorization</title>

    <p>To restrict access to particular priviledge group(s) place the 
    "require privgroup  &lt;group name&gt;" directives in a .htaccess 
    file, a Location block or a Directory block. Multiple directives mean 
    "user must belong to at least one of these groups".</p>

    <p>When combining with other require directives, the order of checking is
    top to bottom, so e.g. by placing "require valid-user" at the top, all
    authenticated users will be authorized no matter what group restrictions 
    are below it.</p>

    <p>It is possible to combine "Require privgroup" with basic auth's "Require
    group". In this case if no LDAP group matches, the basic auth groups
    can be checked by apache in the usual manner, and access granted if the
    user is in them. However when using WebAuthLdap the AuthAuthoritative
    directive must be set to off, otherwise mod_access will logs messages 
    complaining that it doesn't recognize the "Require privgroup" 
    directives.</p>

<example><title>Example</title>
  &lt;Location /private/&gt;<br />
  AuthType WebAuth<br />
  Require privgroup stanford:staff<br />
  Require privgroup stanford:faculty<br />
  &lt;/Location&gt;
</example>

</section>

<section><title>Adhoc attributes lookup</title>

    <p>By using the WebAuthLdapAttribute directive in a .htaccess file, a 
    Location block or a Directory block, any attributes available
    to the WebAuth server can be set into environment variables for use in 
    cgi scripts. In case the requested attribute is not available from the 
    LDAP server, there is no error and the environment variable is simply not 
    set for that attribute. The specified attributes will be set in addition 
    to the defaults, set in all cases when the data is available:</p>
    <ul>
      <li><code>WEBAUTH_LDAP_DISPLAYNAME</code> - User's name in "firstname lastname" format.</li>
      <li><code>WEBAUTH_LDAP_MAIL</code> - User's primary email address</li>
    </ul>

    <p>The name of the environment variable is formed by prepending 
    WEBAUTH_LDAP_ to the uppercased attribute name. In the case of mulivalued 
    attributes, the WEBAUTH_LDAP_ATTRIBUTENAME variable will contain one value
    randomly picked from the set, and all the values of this attribute will 
    also be set into WEBAUTH_LDAP_ATTRIBUTENAME1,  WEBAUTH_LDAP_ATTRIBUTENAME2,
    and so on, in no particular order.</p>

<example><title>Example</title>
  &lt;Location /private/&gt;<br />
  AuthType WebAuth<br />
  Require valid-user<br />
  WebAuthLdapAttribute affiliation<br />
  WebAuthLdapAttribute description<br />
  WebAuthLdapAttribute phoneNumber<br />
  &lt;/Location&gt;
</example>

</section>

<section><title>Minimal Config File</title>

    <p>The following example shows the minimum config file required
    to configure and use mod_webauthldap.</p>

<example><title>Example</title>
  LoadModule webauthldap_module modules/mod_webauthldap.so<br/>
  <br/>

  WebAuthLdapHost ldap.acme.com
  WebAuthLdapBase dc=acme,dc=com
  WebAuthLdapAuthorizationAttribute priviledgeAttribute
  WebAuthLdapKeytab conf/webauth/ldapkeytab webauth/myservername<br/>
  WebAuthLdapTktCache /tmp/webauthldap.tkt<br/>

  <br/>
  &lt;Location /private/&gt;<br />
  AuthType WebAuth<br />
  Require privgroup mygroup<br />
  &lt;/Location&gt;<br/>
</example>

</section>

<directivesynopsis>
<name>WebAuthLdapHost</name>
<description>The hostname for the LDAP server</description>
<syntax>WebAuthLdapHost <em>hostname</em></syntax>
<default>none</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>The ldap server needs to support SASL GSSAPI Kerberos V binds.</p>

<example><title>Example</title>
WebAuthLdapHost ldap.acme.com
</example>
</usage>
</directivesynopsis>

<directivesynopsis>
<name>WebAuthLdapBase</name>
<description>The base for the LDAP lookup</description>
<syntax>WebAuthLdapBase <em>valid_search_base</em></syntax>
<default>none</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>The lookup of the user's entry will begin at the specified base.</p>

<example><title>Example</title>
WebAuthLdapBase cn=people,dc=acme,dc=com
</example>
</usage>
</directivesynopsis>


<directivesynopsis>
<name>WebAuthLdapKeytab</name>
<description>Keytab containing the principal used for binding to the LDAP server.</description>
<syntax>WebAuthLdapKeytab <em>path</em>  [<em>principal</em>]</syntax>
<default>none</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>In case a keytab contains several principals, use the second optional value on this directive to indicate the principal name to use.</p>

<p>If the path is not absolute, it will be treated as being relative to <code>ServerRoot</code>.</p>

<example><title>Example</title>
WebAuthLdapKeytab conf/webauth/ldapkeytab webauth/myservername
</example>
</usage>
</directivesynopsis>



<directivesynopsis>
<name>WebAuthLdapBindDN</name>
<description>The bind DN for the LDAP lookup</description>
<syntax>WebAuthLdapBindDN <em>valid_bind_dn</em></syntax>
<default>none</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>The bind DN specifies the LDAP identity that this module will use when binding to the LDAP server. Some openldap servers do not need an explicit bind DN and determine the binding identity from the authentication credentials.</p>

<example><title>Example</title>
WebAuthLdapBindDN cn=myDN,dc=acme,dc=com
</example>
</usage>
</directivesynopsis>




<directivesynopsis>
<name>WebAuthLdapDebug</name>
<description>Turn on|off the debugging level of logging</description>
<syntax>WebAuthLdapDebug <em>on|off</em></syntax>
<default>off</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>This will print some tracing and debuggin output in the server log, about 
the stages of processing, the ldap parameters and returned results.</p>

<example><title>Example</title>
WebAuthLdapDebug on
</example>
</usage>
</directivesynopsis>


<directivesynopsis>
<name>WebAuthLdapFilter</name>
<description>The LDAP filter to use in searching for the user's entry</description>
<syntax>WebAuthLdapFilter <em>valid_ldap_filter</em></syntax>
<default>uid=USER</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>This can be any properly formed LDAP filter, where the current user's id will be substituted for the upper-cased string "USER". The "USER" string can appear in the filter multiple times.</p>

<example><title>Example</title>
WebAuthLdapFilter (&amp;(objectClass=superson)(uid=USER))
</example>
</usage>
</directivesynopsis>


<directivesynopsis>
<name>WebAuthLdapAuthorizationAttribute</name>
<description>The LDAP attribute that is checked against to determine authorization of a user</description>
<syntax>WebAuthLdapAuthorizationAttribute <em>ldap_attribute_name</em></syntax>
<default>none</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>This specifies the attribute in the LDAP directory that contains the groups used for determining authorization of access. This is expected to be a multi-valued attribute against which ldap compare operations are performed.</p>

<example><title>Example</title>
WebAuthLdapAuthorizationAttribute priviledgeAttribute
</example>
</usage>
</directivesynopsis>


<directivesynopsis>
<name>WebAuthLdapAttribute</name>
<description>Specifies an LDAP attribute to place into environment variables</description>
<syntax>WebAuthLdapAttribute <em>ldap_attribute_name</em></syntax>
<default>"displayName", "mail"</default>
<contextlist><context>directory</context></contextlist>

<usage>
<p>One attribute per directive, but multiple directives can be used. The specified attributes will be set in addition to the default ones.</p>

    <p>The name of the environment variable is formed by prepending 
    WEBAUTH_LDAP_ to the uppercased attribute name. In the case of mulivalued 
    attributes, the WEBAUTH_LDAP_ATTRIBUTENAME variable will contain one value
    randomly picked from the set, and all the values of this attribute will 
    also be set into WEBAUTH_LDAP_ATTRIBUTENAME1,  WEBAUTH_LDAP_ATTRIBUTENAME2,
    and so on, in no particular order.</p>

<example><title>Example</title>
&lt;Location /private/&gt;<br />
AuthType WebAuth<br />
Require privgroup stanford:staff<br />
WebAuthLdapAttribute affiliation<br />
WebAuthLdapAttribute description<br />
WebAuthLdapAttribute phoneNumber<br />
&lt;/Location&gt;<br/>
</example>
</usage>
</directivesynopsis>



<directivesynopsis>
<name>WebAuthLdapTktCache</name>
<description>The path to the Kerberos V credentials cache file</description>
<syntax>WebAuthLdapTktCache <em>path</em></syntax>
<default>/tmp/webauthldap.tkt</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>If the ticket exists, is valid and readable, it will be used until it expires. After expiration, or if it doesn't exist, the specified keytab will be used to obtain a new ticket.</p>

<example><title>Example</title>
WebAuthLdapTktCache /tmp/webauthldap.tkt
</example>
</usage>
</directivesynopsis>




<directivesynopsis>
<name>WebAuthLdapPort</name>
<description>The port on which to connect to the LDAP server.</description>
<syntax>WebAuthLdapPort <em>port_num</em></syntax>
<default>389</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>

<usage>
<p>If using SSL, this should be set to the SSL port on the LDAP server, usually 636.</p>

<example><title>Example</title>
WebAuthLdapPort 389
</example>
</usage>
</directivesynopsis>

<directivesynopsis>
<name>WebAuthLdapSSL</name>
<description>This flag is used to toggle the connection to the LDAP server to be SSL or plain.</description>
<syntax>WebAuthLdapSSL <em>on|off</em></syntax>
<default>off</default>
<contextlist><context>server config</context>
<context>virtual host</context></contextlist>
</directivesynopsis>

</modulesynopsis>
